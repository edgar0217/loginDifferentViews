<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Eventos Alumnos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/css/styles.css" />
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body class="min-h-screen bg-gray-100 p-6">
    <% if (!usuario || usuario.rol !== 'alumno') { %>
    <script>
      window.location.href = "/login";
    </script>
    <% } %>

    <main
      class="max-w-3xl mx-auto bg-gray-900 rounded-xl shadow-lg p-6 text-gray-300"
    >
      <!-- Saludo y cerrar sesión -->
      <div
        class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4"
      >
        <p class="font-semibold text-lg">
          Bienvenid@, <%= usuario.rol.toUpperCase()%>(A) <%= usuario ?
          usuario.nombre.toUpperCase() + " " + usuario.apellidos.toUpperCase() :
          "Invitado" %>
        </p>
        <form action="/logout" method="GET" class="w-full md:w-auto">
          <button
            type="submit"
            class="w-full md:w-auto bg-red-700 hover:bg-red-800 text-white font-semibold px-5 py-2 rounded-lg transition"
          >
            Cerrar sesión
          </button>
        </form>
      </div>

      <h1 class="text-3xl font-extrabold mb-8 text-teal-400">
        Crear Nuevo Evento
      </h1>
      <img
        src="/img/decoracion3.jpg"
        alt="Descripción de la imagen"
        class="w-full max-w-xl mx-auto mb-8 object-contain"
      />

      <% if (error) { %>
      <p
        class="mb-4 p-3 bg-red-900 bg-opacity-50 text-red-400 rounded-lg border border-red-700"
      >
        <%= error %>
      </p>
      <% } %>

      <form
        id="formCrearEvento"
        action="/eventos/nuevo"
        method="POST"
        enctype="multipart/form-data"
        class="space-y-6 mb-12"
      >
        <div>
          <label for="titulo" class="block mb-2 font-semibold text-teal-300"
            >Título del evento</label
          >
          <input
            type="text"
            id="titulo"
            name="titulo"
            required
            class="w-full p-3 border border-gray-700 rounded-lg bg-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-400 text-gray-200"
          />
        </div>

        <div>
          <label
            for="descripcion"
            class="block mb-2 font-semibold text-teal-300"
            >Descripción</label
          >
          <textarea
            id="descripcion"
            name="descripcion"
            rows="4"
            required
            class="w-full p-3 border border-gray-700 rounded-lg bg-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-400 text-gray-200 resize-none"
          ></textarea>
        </div>

        <div>
          <label class="block mb-2 font-semibold text-teal-300"
            >Imagen del evento</label
          >

          <!-- Botón para seleccionar archivo de galería -->
          <button
            type="button"
            id="btnSeleccionarArchivo"
            class="mb-2 bg-teal-700 hover:bg-teal-800 text-white px-4 py-2 rounded-lg"
          >
            Seleccionar foto
          </button>

          <!-- Botón para tomar foto con cámara -->
          <button
            type="button"
            id="btnTomarFoto"
            class="mb-2 bg-teal-700 hover:bg-teal-800 text-white px-4 py-2 rounded-lg"
          >
            Tomar foto
          </button>

          <!-- Inputs ocultos -->
          <input
            type="file"
            id="inputArchivo"
            name="imagen"
            accept="image/*"
            style="display: none"
            onchange="previewImage(event)"
          />

          <input
            type="file"
            id="inputCamara"
            name="imagen"
            accept="image/*"
            capture="environment"
            style="display: none"
            onchange="previewImage(event)"
          />

          <div id="previewContainer" class="mt-4"></div>
        </div>

        <div class="flex flex-col sm:flex-row gap-4">
          <button
            type="submit"
            class="flex-1 py-3 bg-teal-700 hover:bg-teal-800 text-white rounded-lg transition font-semibold"
          >
            Crear Evento
          </button>

          <button
            type="button"
            id="btnLimpiar"
            class="flex-1 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition font-semibold"
          >
            Limpiar formulario
          </button>
        </div>
      </form>

      <h2 class="text-3xl font-extrabold mb-6 text-teal-400">Eventos</h2>

      <% if (eventos.length === 0) { %>
      <p class="text-gray-500">No hay eventos registrados.</p>
      <% } else { %> <% eventos.forEach(evento => { %>
      <div
        class="evento-card p-4 mb-4 border border-gray-700 rounded-lg shadow-md flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-gray-800"
      >
        <div class="flex-1">
          <h3 class="font-semibold text-xl text-teal-300">
            <%= evento.titulo %>
          </h3>
          <p class="text-gray-400 mt-1"><%= evento.descripcion %></p>
          <% if (evento.url_imagen) { %>
          <img
            src="<%= evento.url_imagen %>"
            alt="Imagen evento"
            class="w-full max-w-xs mt-3 rounded-lg border border-teal-600 object-cover"
          />
          <% } %>
        </div>
        <form
          class="formEliminarEvento"
          action="/eventos/<%= evento.id %>?_method=DELETE"
          method="POST"
        >
          <button
            type="submit"
            class="text-red-600 hover:text-red-800 font-semibold transition"
          >
            Eliminar
          </button>
        </form>
      </div>
      <% }) %> <% } %>
    </main>
    <script src="/js/evento.js"></script>
    <script>
            // Mostrar mensaje error con SweetAlert2 si existe
      <% if (error) { %>
      Swal.fire({
        icon: "error",
        title: "Oops...",
        text: "<%= error %>",
      });
      <% } %>
    </script>

    <% if (typeof error !== "undefined" && error) { %>
    <script>
      Swal.fire({
        icon: "error",
        title: "Oops...",
        text: "<%= error %>",
      });
    </script>
    <% } %> <% if (typeof success !== "undefined" && success) { %>
    <script>
      Swal.fire({
        icon: "success",
        title: "¡Éxito!",
        text: "<%= success %>",
        timer: 2000,
        showConfirmButton: false,
      });
    </script>
    <% } %>
  </body>
</html>
